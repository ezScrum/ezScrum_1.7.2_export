*** Settings ***
Suite Setup       Test Suite Export Setup
Suite Teardown    Test Suite Export Teardown
Resource          keywords/common_resource.txt
Resource          keywords/Export/ezScrum_Export_SetupTeardown.txt
Resource          keywords/Export/ezScrum_Export.txt
Resource          Global Define.txt
Library           keywords/lib/JSONFileComparator.py
Library           keywords/lib/ezScrumFileManager.py

*** Test Cases ***
Test Export - Export and Compare With Golden Answer - Project1
    [Setup]    Test Export Setup
    # Choose Project01
    Choose Project By Name    Project01
    # 按下 Export 按鈕
    Click Element    //table[@id = 'exportButton']//button[text() = 'Export']
    # 等待成功訊息視窗顯示
    Wait Until Page Contains    Your data is downloaded!
    # 等待檔案下載成功
    ${wait_for_download_delay}=    Set Variable    3s
    Sleep    ${wait_for_download_delay}
    # 驗證檔案格式及內容
    ${exported_file_path} =    Get Latest Ezscrum JSON File Path In Directory    ${USER_DOWNLOAD_DIRECTORY}
    ${golden_answer_path} =    Catenate    SEPARATOR=\\    ${EZSCRUM_DIRECTORY}    robotTesting    TestData    golden_answer_project01.json
    ${are_files_the_same} =    Compare JSON File    ${exported_file_path}    ${golden_answer_path}
    Should Be True    ${are_files_the_same}    The JSON files are not the same
    [Teardown]    Test Export Teardown

Test Export - Export and Compare With Golden Answer - Project2
    [Setup]    Test Export Setup
    # Choose Project02
    Choose Project By Name    Project02
    # 按下 Export 按鈕
    Click Element    //table[@id = 'exportButton']//button[text() = 'Export']
    # 等待成功訊息視窗顯示
    Wait Until Page Contains    Your data is downloaded!
    # 等待檔案下載成功
    ${wait_for_download_delay}=    Set Variable    3s
    Sleep    ${wait_for_download_delay}
    # 驗證檔案格式及內容
    ${exported_file_path} =    Get Latest Ezscrum JSON File Path In Directory    ${USER_DOWNLOAD_DIRECTORY}
    ${golden_answer_path} =    Catenate    SEPARATOR=\\    ${EZSCRUM_DIRECTORY}    robotTesting    TestData    golden_answer_project02.json
    ${are_files_the_same} =    Compare JSON File    ${exported_file_path}    ${golden_answer_path}
    Should Be True    ${are_files_the_same}    The JSON files are not the same
    [Teardown]    Test Export Teardown

Test Export - Export and Compare With Golden Answer - Two Projects
    [Setup]    Test Export Setup
    # Choose Project01 and Project02
    Choose Project By Name    Project01
    Choose Project By Name    Project02
    # 按下 Export 按鈕
    Click Element    //table[@id = 'exportButton']//button[text() = 'Export']
    # 等待成功訊息視窗顯示
    Wait Until Page Contains    Your data is downloaded!
    # 等待檔案下載成功
    ${wait_for_download_delay}=    Set Variable    3s
    Sleep    ${wait_for_download_delay}
    # 驗證檔案格式及內容
    ${exported_file_path} =    Get Latest Ezscrum JSON File Path In Directory    ${USER_DOWNLOAD_DIRECTORY}
    ${golden_answer_path} =    Catenate    SEPARATOR=\\    ${EZSCRUM_DIRECTORY}    robotTesting    TestData    golden_answer_project01_project02.json
    ${are_files_the_same} =    Compare JSON File    ${exported_file_path}    ${golden_answer_path}
    Should Be True    ${are_files_the_same}    The JSON files are not the same
    [Teardown]    Test Export Teardown
